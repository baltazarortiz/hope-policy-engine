#!/bin/bash
SCRIPT_DIR="$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )"
renode_file=/tmp/$(id -u -n)_renode.txt
cat > $renode_file <<- EOF
mach create
machine LoadPlatformDescription @platforms/boards/miv-board.repl
sysbus.cpu MaximumBlockSize 1
showAnalyzer sysbus.uart
EOF
full_path=`readlink -f $1`
echo "sysbus LoadELF @$full_path" >> $renode_file
echo "sysbus.cpu SetExternalValidator @$SCRIPT_DIR/../build/librv32-renode-validator.so @$SCRIPT_DIR/../policy @$SCRIPT_DIR/..//application_tags.taginfo" >> $renode_file
~/hope-repos/renode/renode $renode_file
